function negotiate(e,t,n){var i=Object.keys(t),r=e.headers[n||"accept"]||"*",a=MimeParse.bestMatch(i,r);return t[a]}var Q=require("q"),MimeParse=require("mimeparse"),Status=require("./status");exports.negotiate=negotiate,exports.Method=function(e,t){var n=Object.keys(e);return t||(t=Status.methodNotAllowed),function(i,r){var a=i.method;return Object.has(n,a)?Object.get(e,a)(i,r):t(i,r)}};var Negotiator=function(e,t,n){return function(i,r){var a=Object.keys(i);return r||(r=Status.notAcceptable),function(s){var o=s.headers[e]||"*",l=MimeParse.bestMatch(a,o);return s.terms=s.terms||{},s.terms[t]=l,Object.has(a,l)?Q.when(i[l](s,response),function(e){return null!==n&&e&&200===e.status&&e.headers&&(e.headers[t]=l),e}):r(s)}}};exports.ContentType=Negotiator("accept","content-type"),exports.Language=Negotiator("accept-language","language"),exports.Charset=Negotiator("accept-charset","charset"),exports.Encoding=Negotiator("accept-encoding","encoding"),exports.Host=function(e,t){var n=Object.keys(e).map(function(t){var n=t.split(":");return[t,n[0]||"*",n[1]||"*",e[t]]});return t||(t=Status.notAcceptable),function(e){for(var i=0;n.length>i;i++){var r=n[i],a=r[0],s=r[1],o=r[2],l=r[3];if(!("*"!==s&&s!==e.hostname||"*"!==o&&o!==""+e.port))return e.terms=e.terms||{},e.terms.host=a,l(e)}return t(e)}},exports.Select=function(e){return function(t,n){return Q.when(e(t,n),function(e){return e(t,n)})}};